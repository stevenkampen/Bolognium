{% extends 'layouts/%s.html' % (layout) %}

{% block title %}
	Edit Post ID: {{post_id}}
{% endblock %}

{% block body %}

<h1>Edit Post ID: {{post_id}}</h1>

<div class="{{ 'success' if post.enabled else 'alert' }} message">
  <form id="post-toggle-enabled" class="fancy" method="POST" action="/post/edit/{{post_id}}">
  <table>
    <tbody>
      <tr>
        <td>
          <strong><span>This Post is {{ 'enabled' if post.enabled else 'disabled' }}.</span></strong>
          <input name="enabled" type="hidden" value="{{ '0' if post.enabled else '1' }}"/>
        </td>
        <td>
          <input type="submit" value="{{ 'Disable' if post.enabled else 'Enable' }}" style="margin-left:10px;"/>
        </td>
      </tr>
    </tbody>
  </table>
  </form>
</div>
<div style="background-color:#F8F8FF;padding:0 10px;margin-bottom:10px;border:1px solid #E6E6FA;">
  <h2>Active Slugs</h2>
  {% if post.slugs|count %}
  <table style="margin-left:20px;">
    <tbody>
      {% for slug in post.slugs %}
      <tr>
        <td><em>{{slug}}</em></td>
        <td>
          <form id="post-delete-slug-form" class="fancy" method="POST" action="/post/edit/{{post.key.id()}}">
            <input name="slugs.[DELETE:{{slug}}]" type="hidden" value="true"/>
            <input type="submit" value="Delete" style="margin-left: 5px;padding:2px 2px;font-size:80%;"/>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
    <span style="alert">There are no slugs attached to this Post.</span>
  {% endif %}
</div>
<div style="background-color:#F8F8FF;padding:0 10px;margin-bottom:10px;border:1px solid #E6E6FA;">
  <h2>Add Another Slug</h2>
  <form id="post-add-slug-form" class="fancy" method="POST" action="/post/edit/{{post.key.id()}}">
  <table width="70%">
    <tbody>
      <tr>
        <td>
          <input name="slugs.[ADD]" type="text" style="width:95%;" value="{{ input.get('slugs.[ADD]')|default('', True) }}"/>
        </td>
        <td>
          <input type="submit" value="Add Slug" style="margin:0;"/>
        </td>
      </tr>
      <tr>
        <td colspan="2">
          <span class="form-field-note">Can contain up to <span style="font-weight:bold;">100</span> characters, but only lowercase letters and the hyphen (<span style="font-weight:bold;font-size:150%;">-</span>).</span>
          {% if errors.get('slugs.[ADD]') %}
            <span class="form-field-note form-error">{{errors.get('slugs.[ADD]').msg()}}</span>
          {% endif %}
        </td>
      </tr>
    </tbody>
  </table>
  </form>
</div>
<div>
  <form id="post-edit-form" method="POST" action="/post/edit/{{post_id}}" style="width:100%;" class="fancy">
    <div style="padding:0;">
      <div>
        <label for="title">Edit Title</label>
        <span class="form-field-note">e.g. <span style="font-style:italic;">Summer Girl Beach Festival!</span></span>
        <input name="title" type="text" style="width:70%;" value="{{ input.get('title')|default(post.title, True) }}"/>
        <span class="form-field-note">Can contain up to <span style="font-weight:bold;">150</span> characters of most types.</span>
        {% if errors.get('title') %}
          <span class="form-field-note form-error">{{errors.get('title').msg()}}</span>
        {% endif %}
      </div>

      <div>
        <label for="teaser">Edit Teaser</label>
        <textarea name="teaser" style="width:70%;" rows="3">{{ input.get('teaser')|default(post.teaser, True) }}</textarea>
        <span class="form-field-note">Can contain up to <span style="font-weight:bold;">500</span> characters of plain text.</span>
        {% if errors.get('teaser') %}
          <span class="form-field-note form-error">{{errors.get('teaser').msg()}}</span>
        {% endif %}
      </div>

      <div>
        <label for="body">Edit Body</label>
        <div id="post-body-wysiwyg-toolbar" class="wysiwyg-textarea-input-toolbar"></div>
        <textarea name="body" id="post-body-wysiwyg" class="wysiwyg-textarea-input" style="width:70%;min-height:500px;"></textarea>
        <script type="text/javascript">
          _registerKick(
            'app.startEditorOnField',
            ['post-body-wysiwyg', 'post-edit-form', {{utils.json.dumps(input.get('body', '')|default(post.body, True))}}]
          );
        </script>
        {% if errors.get('body') %}
          <span class="form-field-note form-error">{{errors.get('body').msg()}}</span>
        {% endif %}
        
      </div>
      <input type="submit" value="Update Post"/>
    </div>
  </form>
</div>
{% endblock %}
